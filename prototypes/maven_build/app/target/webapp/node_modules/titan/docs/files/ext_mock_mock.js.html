<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>ext\mock\mock.js - Titan</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.5.1&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.5.1&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="Titan"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.7</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/Titan.Application.html">Titan.Application</a></li>
            
                <li><a href="..&#x2F;classes/Titan.Collection.html">Titan.Collection</a></li>
            
                <li><a href="..&#x2F;classes/Titan.Element.html">Titan.Element</a></li>
            
                <li><a href="..&#x2F;classes/Titan.EventBus.html">Titan.EventBus</a></li>
            
                <li><a href="..&#x2F;classes/Titan.MainController.html">Titan.MainController</a></li>
            
                <li><a href="..&#x2F;classes/Titan.mock.html">Titan.mock</a></li>
            
                <li><a href="..&#x2F;classes/Titan.Model.html">Titan.Model</a></li>
            
                <li><a href="..&#x2F;classes/Titan.Place.html">Titan.Place</a></li>
            
                <li><a href="..&#x2F;classes/Titan.Presenter.html">Titan.Presenter</a></li>
            
                <li><a href="..&#x2F;classes/Titan.Router.html">Titan.Router</a></li>
            
                <li><a href="..&#x2F;classes/Titan.utils.html">Titan.utils</a></li>
            
                <li><a href="..&#x2F;classes/Titan.View.html">Titan.View</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/Mock.html">Mock</a></li>
            
                <li><a href="..&#x2F;modules/Titan.html">Titan</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: ext\mock\mock.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
require([&#x27;Titan&#x27;], function (Titan) {

    Titan.extension(function (env) {
        var Backbone = env.Backbone;
        var _ = env._;

        &#x2F;&#x2F; Generate four random hex digits.
        function S4() {
            return (((1+Math.random())*0x10000)|0).toString(16).substring(1);
        }

        &#x2F;&#x2F; Generate a pseudo-GUID by concatenating random hexadecimal.
        function guid() {
            return (S4()+S4()+&quot;-&quot;+S4()+&quot;-&quot;+S4()+&quot;-&quot;+S4()+&quot;-&quot;+S4()+S4()+S4());
        }

        var Store = function(name) {
            this.name = name;
            var store = this.localStorage().getItem(this.name);
            this.records = (store &amp;&amp; store.split(&quot;,&quot;)) || [];
        };

        _.extend(Store.prototype, {
            &#x2F;&#x2F; Save the current state of the **Store** to *localStorage*.
            save: function() {
                this.localStorage().setItem(this.name, this.records.join(&quot;,&quot;));
            },

            &#x2F;&#x2F; Add a model, giving it a (hopefully)-unique GUID, if it doesn&#x27;t already
            &#x2F;&#x2F; have an id of it&#x27;s own.
            create: function(model) {
                if (!model.id) {
                    model.id = guid();
                    model.set(model.idAttribute, model.id);
                }
                this.localStorage().setItem(this.getItemId(model.id), JSON.stringify(model));
                this.records.push(model.id.toString());
                this.save();
                return model.toJSON();
            },

            &#x2F;&#x2F; Update a model by replacing its copy in &#x60;this.data&#x60;.
            update: function(model) {
                this.localStorage().setItem(this.getItemId(model.id), JSON.stringify(model));
                if (!_.include(this.records, model.id.toString())) this.records.push(model.id.toString()); this.save();
                return model.toJSON();
            },

            &#x2F;&#x2F; Retrieve a model from &#x60;this.data&#x60; by id.
            find: function(id) {
                return JSON.parse(this.localStorage().getItem(this.getItemId(id)));
            },

            &#x2F;&#x2F; Return the array of all models currently in storage.
            findAll: function() {
                return _(this.records).chain()
                    .map(function(id){return JSON.parse(this.localStorage().getItem(this.getItemId(id)));}, this)
                    .compact()
                    .value();
            },

            &#x2F;&#x2F; Delete a model from &#x60;this.data&#x60;, returning it.
            destroy: function(model) {
                this.localStorage().removeItem(this.getItemId(model.id));
                this.records = _.reject(this.records, function(record_id){return record_id == model.id.toString();});
                this.save();
                return model;
            },

            clear: function() {
                var data = this.localStorage().getItem(this.name);
                if (data != undefined &amp;&amp; data != &#x27;&#x27;) {
                    var ids = data.split(&quot;,&quot;);
                    var self = this;
                    _.each(ids, function(id) {
                        self.localStorage().removeItem(self.getItemId(id));
                    });
                    this.localStorage().removeItem(this.name);
                    this.records = [];
                }
            },

            getItemId: function(id) {
                return this.name + &quot;-&quot; + id;
            },

            localStorage: function() {
                return localStorage;
            }
        });

        &#x2F;&#x2F; localSync delegate to the model or collection&#x27;s
        &#x2F;&#x2F; *localStorage* property, which should be an instance of &#x60;Store&#x60;.
        &#x2F;&#x2F; window.Store.sync and Backbone.localSync is deprectated, use Backbone.LocalStorage.sync instead
        Store.sync = Backbone.localSync = function(method, model, options, error) {
            var store = model.localStorage || model.collection.localStorage;

            &#x2F;&#x2F; Backwards compatibility with Backbone &lt;= 0.3.3
            if (typeof options == &#x27;function&#x27;) {
                options = {
                    success: options,
                    error: error
                };
            }

            var resp;

            switch (method) {
                case &quot;read&quot;:    resp = model.id != undefined ? store.find(model.id) : store.findAll(); break;
                case &quot;create&quot;:  resp = store.create(model);                            break;
                case &quot;update&quot;:  resp = store.update(model);                            break;
                case &quot;delete&quot;:  resp = store.destroy(model);                           break;
            }

            if (resp) {
                options.success(resp);
            } else {
                options.error(&quot;Record not found&quot;);
            }
        };

        Backbone.ajaxSync = Backbone.sync;

        Backbone.getSyncMethod = function(model) {
            if(model.localStorage || (model.collection &amp;&amp; model.collection.localStorage)) {
                return Backbone.localSync;
            }
            return Backbone.ajaxSync;
        };

        &#x2F;&#x2F; Override &#x27;Backbone.sync&#x27; to default to localSync,
        &#x2F;&#x2F; the original &#x27;Backbone.sync&#x27; is still available in &#x27;Backbone.ajaxSync&#x27;
        Backbone.sync = function(method, model, options, error) {
            return Backbone.getSyncMethod(model).apply(this, [method, model, options, error]);
        };


        &#x2F;**
         * Titan extension for testing models
         *
         * @module Mock
         * @class Titan.mock
         *&#x2F;
        var Mock = Titan.mock = {
            get: function(Model, id) {
                return Model.prototype.localStorage.find(id);
            },

            put: function(Model, jsonData) {
                var model = new Model(jsonData);
                return model.localStorage.create(model);
            },

            clear: function(Model) {
                Model.prototype.localStorage.clear();
            },

            register: function(Model, mockUrl) {
                Model.prototype.localStorage = new Store(mockUrl);
                Mock.clear(Model);
            }
        };

    });

});
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
